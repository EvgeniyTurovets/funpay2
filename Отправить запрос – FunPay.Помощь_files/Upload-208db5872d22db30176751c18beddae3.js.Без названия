(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{e27cdf3ff904ddeaf21c:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return j}));var i,r,s=a("549a709a8f94b14e0e58"),o=a.n(s),n=a("5f95f5d90d238fa0d86a"),l=a.n(n),d=a("500407a0058749d1d795"),u=a.n(d),h=a("e3f51e93cbcb086f6c06"),c=a.n(h),p=a("ac984996a79308ebe69c"),f=a.n(p),m=a("279c0f0c00aa45d41952"),b=a.n(m),v=a("9466c4bf0b991fb30fa6"),x=a.n(v),g=a("a3ffdb541eb5f4236c8d"),y=a.n(g),$=a("e026a4a5eab83117dbc9"),_=a.n($),w=a("7dcb1f9d91649c22471e"),k=a.n(w),T=a("802cdb4f0b591dfd1229"),U=a.n(T),z=a("a8f8105d2d40178f277f"),E=a("aa002c9ecdc30c05062b"),P=a.n(E),R=a("12567f097106441c944d");a("000537dc14f76cdbe8f1");function j(t){var e,a;this.$uploader=U()(t),this.$dropzone=U()("#".concat(this.$uploader.data("dropzone"))),this.$error=U()("#".concat(this.$uploader.data("error"))),this.$pool=U()("#".concat(this.$uploader.data("pool")));var i=U()("#".concat(this.$pool.data("template"))).html();this.$template=U()(k()(U.a).call(U.a,i)),this.url=this.$uploader.data("create-url"),this.name=this.$uploader.data("name"),this.deleteConfirmMsg=this.$uploader.data("delete-confirm-msg"),this.serialiazedObject=-1===_()(e=this.name).call(e,"_ids][]"),this.uploadError=!1,this.$form=U()(t.form),this.$submit=y()(a=this.$form).call(a,"[type=submit]"),this.isUploading=!1,this.submissionPending=!1,this.init()}j.prototype={init:function(){this.cleanup(),this.populate(),this.setup()},cleanup:function(){this.$pool.empty(),this.$error.hide()},populate:function(){var t=this.$pool.data("uploads")||[],e=this;!function a(){var i=t.shift();if(i){var r=i.display_file_name||i.file_name,s=e.render(r);e.setupload(s,i),e.append(s),x()(a,4)}}()},render:function(t){var e=this.$template.clone();return this.setLinkText(e,t),this.setInputName(e),e},append:function(t){this.$pool.append(t)},setupload:function(t,e){this.setLinkUrl(t,e.url),this.setPathUrl(t,e.url),this.setRemoveUrl(t,e.delete_url),this.setInputValue(t,e),this.setProgress(t,100),this.setRemoveEvent(t)},setLinkText:function(t,e){y()(t).call(t,"[data-upload-link]").text(e)},setInputName:function(t){y()(t).call(t,"input:hidden").attr("name",this.name)},setLinkUrl:function(t,e){y()(t).call(t,"[data-upload-link]").attr("href",e)},setPathUrl:function(t,e){y()(t).call(t,"[data-upload-path]").text(e)},setRemoveUrl:function(t,e){y()(t).call(t,"[data-upload-remove]").data("delete-url",e)},setInputValue:function(t,e){var a=this.serialiazedObject?e:e.id;y()(t).call(t,"input:hidden").val(b()(a))},setProgress:function(t,e){y()(t).call(t,"[data-upload-progress]").css("width","".concat(e,"%"))},setRemoveEvent:function(t){var e;y()(t).call(t,"[data-upload-remove]").click(U.a.proxy(this.remove,this)),y()(t).call(t,"[data-upload-remove]").keyup(f()(e=this.handleKeyUp).call(e,this))},handleKeyUp:function(t){t.preventDefault(),13!==t.keyCode&&32!==t.keyCode||U.a.proxy(this.remove,this)(t)},setup:function(){this.$uploader.fileupload({dropZone:this.$dropzone,pasteZone:null,url:this.url,dataType:"json",type:"POST",paramName:"file",singleFileUploads:!0,dragover:U.a.proxy(this.dragover,this),add:U.a.proxy(this.add,this),progress:U.a.proxy(this.progress,this),done:U.a.proxy(this.done,this),fail:U.a.proxy(this.error,this),start:U.a.proxy(this.start,this),stop:U.a.proxy(this.stop,this)}),this.$form.on("submit",U.a.proxy(this.submit,this)),this.$dropzone.focusin(U.a.proxy(this.focus,this)),this.$dropzone.focusout(U.a.proxy(this.blur,this))},dragover:function(){var t=this,e=window.dropZoneTimeout;e?clearTimeout(e):this.$dropzone.attr("data-hover",!0),window.dropZoneTimeout=x()((function(){window.dropZoneTimeout=null,t.$dropzone.attr("data-hover",!1)}),100)},add:(r=c()(u.a.mark((function t(e,a){var i,r,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.files[0],t.next=3,Object(R.b)();case 3:if(r=t.sent,!this.exists(i.name)){t.next=7;break}return this.flash("File already exists",i.name),t.abrupt("return");case 7:if(void 0===i.size){t.next=11;break}if(this.valid(i)){t.next=11;break}return this.flash("File invalid"),t.abrupt("return");case 11:(s=this.render(i.name)).attr("aria-busy",!0),this.append(s),a.context=s,a.formData=[{name:"authenticity_token",value:r}],a.submit();case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)}),exists:function(t){var e,a,i=this;return!!l()(e=y()(a=this.$pool).call(a,"a")).call(e,(function(){return i.innerText===t})).length},valid:function(t){return t.size>0},progress:function(t,e){var a=e.context;if(a){var i=o()(e.loaded/e.total*100,10);i<=90&&this.setProgress(a,i)}},done:function(t,e){var a=e.context;this.setupload(a,e.result),x()((function(){a.attr("aria-busy",!1)}),1e3)},remove:(i=c()(u.a.mark((function t(e){var a,i,r,s,o,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=this.deleteConfirmMsg).length||window.confirm(a)){t.next=3;break}return t.abrupt("return");case 3:return i=U()(e.currentTarget),r=i.closest("[data-upload-item]"),s=i.data("delete-url"),o=this,t.next=6,Object(R.b)();case 6:n=t.sent,this.destroy(s,n).done((function(){r.remove(),o.$uploader.trigger("fileuploadremove")}));case 8:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)}),destroy:function(t,e){return U.a.ajax({url:t,method:"DELETE",beforeSend:function(t){t.setRequestHeader("X-CSRF-Token",e)}})},error:function(t,e){var a=e.context,i=this.errorDetails(e);a.remove(),this.uploadError=!0,this.flash(e.errorThrown,i)},errorDetails:function(t){return t.jqXHR.responseJSON&&t.jqXHR.responseJSON[0]&&t.jqXHR.responseJSON[0].error||null},flash:function(t,e){var a,i;switch(t){case"Bad Request":case"File too big":i=P()("txt.help_center.views.shared.upload_error.file_too_big");break;case"File invalid":i=P()("txt.help_center.views.shared.upload_error.file_invalid");break;case"File already exists":i=P()("txt.help_center.views.shared.upload_error.file_already_exist",{filename:e});break;case"Unprocessable Entity":i=P()("txt.help_center.views.shared.upload_error.file_too_big_with_limit",{limit:e.size_limit});break;case"Payload Too Large":i=e;break;case"Request Entity Too Large":default:i=P()("txt.help_center.views.shared.upload_error.connection_lost")}y()(a=this.$error.show()).call(a,"[data-upload-error-message]").text(i)},start:function(){this.isUploading=!0},stop:function(){this.isUploading=!1,!this.submissionPending||this.uploadError?(this.submissionPending&&this.uploadError&&(this.submissionPending=!1,this.$submit.prop("disabled",!1)),this.uploadError=!1):this.$form.submit()},submit:function(t){(1!==z.a.get("theming_api_version")||this.isUploading)&&(t.preventDefault(),this.$submit.prop("disabled",!0),this.submissionPending=!0,this.isUploading||this.$form[0].submit())},focus:function(){this.$dropzone.attr("data-hc-focus",!0)},blur:function(){this.$dropzone.attr("data-hc-focus",!1)}}}}]);